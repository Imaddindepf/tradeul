================================================================================
GU√çA DE TESTING MANUAL - FASE 1
Ticker Metadata Service
================================================================================

Cuando est√©s listo para probar el nuevo servicio, sigue estos pasos:

================================================================================
PASO 1: LEVANTAR INFRAESTRUCTURA BASE
================================================================================

# Aseg√∫rate de estar en el directorio correcto
cd /Users/imaddinamsif/Desktop/Tradeul-Amsif

# Levantar Redis y TimescaleDB primero
docker-compose up -d redis timescaledb

# Esperar 15 segundos
sleep 15

# Verificar que est√©n corriendo
docker-compose ps

# Deber√≠as ver:
# tradeul_redis       running
# tradeul_timescale   running

================================================================================
PASO 2: BUILD Y LEVANTAR NUEVO SERVICIO
================================================================================

# Build del nuevo servicio
docker-compose build ticker_metadata

# Levantar el servicio
docker-compose up -d ticker_metadata

# Ver los logs en tiempo real (Ctrl+C para salir)
docker logs -f tradeul_ticker_metadata

# Busca estas l√≠neas en los logs:
# ‚úì "ticker_metadata_service_starting"
# ‚úì "redis_connected"
# ‚úì "timescale_connected"
# ‚úì "metadata_manager_initialized"
# ‚úì "ticker_metadata_service_ready"

================================================================================
PASO 3: RESTART API GATEWAY
================================================================================

# Para que reconozca el nuevo servicio
docker-compose restart api_gateway

# Esperar 10 segundos
sleep 10

================================================================================
PASO 4: TESTING B√ÅSICO
================================================================================

# Test 1: Health Check del nuevo servicio
curl http://localhost:8010/health

# Deber√≠a retornar:
# {"status":"healthy","service":"ticker-metadata-service","version":"1.0.0",...}

# Test 2: Obtener metadata de Apple
curl http://localhost:8010/api/v1/metadata/AAPL

# Deber√≠a retornar JSON con:
# - symbol: "AAPL"
# - company_name: "Apple Inc."
# - sector: "Technology"
# - industry: ...
# - market_cap: ...

# Test 3: Via API Gateway (con fallback)
curl http://localhost:8000/api/v1/ticker/AAPL/metadata

# Deber√≠a retornar lo mismo que Test 2

# Test 4: Stats del servicio
curl http://localhost:8010/api/v1/metadata/stats/service

# Deber√≠a retornar:
# {"cache_hit_rate": "...", "cache_hits": ..., "api_calls": ...}

================================================================================
PASO 5: TESTING COMPLETO AUTOMATIZADO
================================================================================

# Ejecutar el script completo con 11 tests
./test_ticker_metadata_service.sh

# El script verificar√°:
# ‚úì Pre-flight checks (Redis, TimescaleDB, servicios)
# ‚úì Health checks
# ‚úì Metadata endpoints (4 s√≠mbolos)
# ‚úì Company endpoints
# ‚úì Statistics endpoints
# ‚úì Service stats
# ‚úì API Gateway integration
# ‚úì Cache verification
# ‚úì Fallback behavior
# ‚úì Performance check (10 requests)

================================================================================
PASO 6: VERIFICAR CACHE EN REDIS
================================================================================

# Ver keys de cache creados
docker exec tradeul_redis redis-cli KEYS "ticker:metadata:*"

# Deber√≠as ver algo como:
# ticker:metadata:AAPL
# ticker:metadata:TSLA
# etc.

# Ver contenido de un cache entry
docker exec tradeul_redis redis-cli GET "ticker:metadata:AAPL"

================================================================================
PASO 7: TESTING DESDE FRONTEND
================================================================================

# 1. Aseg√∫rate de que frontend est√© corriendo
docker-compose up -d frontend

# 2. Abre en tu navegador:
http://localhost:3000/scanner

# 3. Espera a que cargue la tabla con tickers

# 4. Haz click en cualquier s√≠mbolo (texto azul en columna Symbol)

# 5. Deber√≠a abrir un modal con:
   ‚úì Company Information (nombre, exchange, sector, industria)
   ‚úì Exchange & Classification
   ‚úì Market Capitalization (market cap, float shares)
   ‚úì Average Volume
   ‚úì Price Statistics
   ‚úì Metadata Info (√∫ltima actualizaci√≥n)

# 6. El modal deber√≠a:
   ‚úì Abrirse r√°pido (< 1 segundo)
   ‚úì Mostrar datos reales del ticker
   ‚úì No mostrar errores
   ‚úì Cerrarse con Escape o bot√≥n Close

================================================================================
PASO 8: VERIFICAR LOGS (Importante)
================================================================================

# Logs del nuevo servicio
docker logs tradeul_ticker_metadata --tail=100

# Busca estos eventos (deben ser INFO, no ERROR):
‚úì ticker_metadata_service_starting
‚úì redis_connected
‚úì timescale_connected
‚úì ticker_metadata_service_ready
‚úì metadata_cache_hit (cuando haces requests repetidos)
‚úì metadata_enriched (cuando enriquece desde Polygon)

# NO deber√≠as ver:
‚úó ERROR
‚úó CRITICAL
‚úó Connection failed
‚úó Timeout

# Logs del API Gateway
docker logs tradeul_api_gateway --tail=50

# Busca:
‚úì Requests a /api/v1/ticker/{symbol}/metadata
‚úì No deber√≠a haber errores 500

================================================================================
PASO 9: TESTING DE FALLBACK
================================================================================

# Test con servicio funcionando
curl http://localhost:8000/api/v1/ticker/TSLA/metadata
# Deber√≠a funcionar

# Detener el servicio para probar fallback
docker-compose stop ticker_metadata

# Test sin servicio (deber√≠a usar fallback DB)
curl http://localhost:8000/api/v1/ticker/TSLA/metadata
# Deber√≠a SEGUIR funcionando (usando DB directamente)

# Verificar logs del gateway (deber√≠a ver warning sobre fallback)
docker logs tradeul_api_gateway --tail=20
# Busca: "metadata_service_unavailable" o "using_fallback_db_query"

# Levantar de nuevo el servicio
docker-compose up -d ticker_metadata

================================================================================
PASO 10: PERFORMANCE CHECK
================================================================================

# Test de latencia (10 requests)
time for i in {1..10}; do
  curl -s http://localhost:8010/api/v1/metadata/AAPL > /dev/null
done

# Primera request puede ser ~500ms (cold, llama a Polygon)
# Siguientes requests deber√≠an ser < 10ms (cache hit)

# Ver stats
curl http://localhost:8010/api/v1/metadata/stats/service

# Cache hit rate deber√≠a ser > 70% despu√©s de varios requests

================================================================================
CRITERIOS DE √âXITO
================================================================================

Para considerar el testing EXITOSO, TODOS estos deben cumplirse:

‚úì Servicio arranca sin errores
‚úì Health check responde HTTP 200
‚úì Metadata endpoint devuelve datos v√°lidos de AAPL
‚úì API Gateway funciona (con servicio running)
‚úì API Gateway fallback funciona (con servicio stopped)
‚úì Frontend modal abre correctamente
‚úì Frontend modal muestra datos reales
‚úì No hay errores en logs (ticker_metadata ni api_gateway)
‚úì Cache funciona (keys en Redis)
‚úì Cache hit rate > 70% (despu√©s de varios requests)
‚úì Latencia cache hit < 20ms
‚úì Sistema puede correr 1 hora sin crashes

================================================================================
SI TODO FUNCIONA CORRECTAMENTE
================================================================================

¬°Felicidades! El servicio funciona. Ahora puedes:

1. MERGE A MAIN:
   git checkout main
   git merge feature/ticker-metadata-service --no-ff
   git push origin main

2. DEPLOY A PRODUCCI√ìN (si aplica):
   ssh production
   cd ~/tradeul
   git pull origin main
   docker-compose up -d --build ticker_metadata
   docker-compose restart api_gateway

3. MONITOR POR 24-48 HORAS:
   - docker logs -f tradeul_ticker_metadata
   - Verificar cache hit rate
   - Verificar latencias
   - Verificar que no hay memory leaks
   - Verificar que frontend funciona sin issues

================================================================================
SI ALGO FALLA
================================================================================

Ver: services/ROLLBACK_PLAN.txt

ROLLBACK R√ÅPIDO (< 2 minutos):

# Opci√≥n 1: Detener servicio
docker-compose stop ticker_metadata
docker-compose restart api_gateway
# ‚Üí Sistema sigue funcionando con fallback

# Opci√≥n 2: Volver a main
git checkout main
docker-compose up -d --build

================================================================================
TROUBLESHOOTING COM√öN
================================================================================

Problema: "Connection refused" al llamar puerto 8010
Soluci√≥n:
  - Verificar servicio est√° corriendo: docker-compose ps
  - Verificar logs: docker logs tradeul_ticker_metadata
  - Verificar Redis y DB est√°n up

Problema: "404 Not Found" para un s√≠mbolo
Soluci√≥n:
  - Normal si el s√≠mbolo no existe en Polygon
  - Para AAPL/TSLA/NVDA deber√≠a funcionar
  - Verificar POLYGON_API_KEY en .env

Problema: Frontend modal muestra "Error al cargar metadatos"
Soluci√≥n:
  - Verificar api-gateway est√° corriendo
  - Verificar endpoint: curl http://localhost:8000/api/v1/ticker/AAPL/metadata
  - Ver consola del navegador (F12)

Problema: Latencia muy alta (> 1 segundo)
Soluci√≥n:
  - Primera request es normal (cold start)
  - Siguientes deber√≠an ser r√°pidas (cache)
  - Verificar cache hit rate
  - Verificar Redis no est√° sobrecargado

Problema: Service stats muestra muchos errors
Soluci√≥n:
  - Revisar logs detalladamente
  - Verificar conexi√≥n a Polygon API
  - Verificar rate limiting (no m√°s de 5 req/s a Polygon)

================================================================================
CONTACTOS Y REFERENCIAS
================================================================================

Documentaci√≥n:
- README_FASE1.txt (quick reference)
- QUICKSTART_PHASE1.txt (deployment guide)
- FASE_1_RESUMEN_FINAL.txt (complete summary)
- services/ticker-metadata-service/README.txt (API docs)
- services/PHASE_1_COMPLETED.txt (technical details)
- services/ROLLBACK_PLAN.txt (if things fail)

Scripts:
- ./test_ticker_metadata_service.sh (automated testing)

Branch:
- feature/ticker-metadata-service
- https://github.com/Imaddindepf/tradeul/tree/feature/ticker-metadata-service

Backup:
- backup/pre-phase-1-migration

================================================================================
RESUMEN DE COMANDOS R√ÅPIDOS
================================================================================

# Setup completo en una l√≠nea
docker-compose up -d redis timescaledb && sleep 15 && \
docker-compose build ticker_metadata && \
docker-compose up -d ticker_metadata && sleep 10 && \
docker-compose restart api_gateway && sleep 10 && \
curl http://localhost:8010/health

# Testing b√°sico
curl http://localhost:8010/health
curl http://localhost:8010/api/v1/metadata/AAPL
curl http://localhost:8000/api/v1/ticker/AAPL/metadata

# Ver logs
docker logs -f tradeul_ticker_metadata

# Testing completo
./test_ticker_metadata_service.sh

# Rollback
docker-compose stop ticker_metadata && docker-compose restart api_gateway

================================================================================
¬°√âXITO CON EL TESTING! üöÄ
================================================================================

