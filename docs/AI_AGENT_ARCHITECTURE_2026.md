# Tradeul AI Agent - Informe ArquitectÃ³nico Completo
## Estado Actual vs. SOTA 2025-2026

**Fecha:** 2026-01-20  
**VersiÃ³n:** 2.0  
**Basado en:** InvestigaciÃ³n de frameworks actuales, papers acadÃ©micos y best practices de la industria

---

## Ãndice

1. [Resumen Ejecutivo](#1-resumen-ejecutivo)
2. [Arquitectura Actual](#2-arquitectura-actual)
3. [Inventario de Datos](#3-inventario-de-datos)
4. [AnÃ¡lisis de la SoluciÃ³n Actual](#4-anÃ¡lisis-de-la-soluciÃ³n-actual)
5. [Arquitecturas SOTA 2025-2026](#5-arquitecturas-sota-2025-2026)
6. [RecomendaciÃ³n de Arquitectura](#6-recomendaciÃ³n-de-arquitectura)
7. [Plan de ImplementaciÃ³n](#7-plan-de-implementaciÃ³n)

---

## 1. Resumen Ejecutivo

### DiagnÃ³stico

La arquitectura actual del AI Agent de Tradeul utiliza un **Intent Router hÃ­brido** (regex + embeddings locales) que **NO estÃ¡ alineado** con las mejores prÃ¡cticas de 2025-2026.

| Aspecto | Actual | SOTA 2025-2026 |
|---------|--------|----------------|
| ClasificaciÃ³n de intents | Regex + MiniLM local | LLM Function Calling nativo |
| OrquestaciÃ³n | LÃ³gica if/else hardcodeada | LangGraph / OpenAI Agents SDK |
| Memoria | Sin persistencia | Checkpointing + Memory Store |
| Text-to-SQL | Prompt engineering bÃ¡sico | Schema Linking + Self-correction |
| RAG | No implementado | GraphRAG / Agentic RAG |

### ConclusiÃ³n

Se requiere una refactorizaciÃ³n hacia una arquitectura basada en:
1. **LangGraph** para orquestaciÃ³n stateful
2. **Gemini Function Calling nativo** (sin router local)
3. **MCP (Model Context Protocol)** para conectores de datos
4. **Sistema de memoria dual** (short-term + long-term)

---

## 2. Arquitectura Actual

### 2.1 Diagrama de Componentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           FRONTEND (Next.js)                                 â”‚
â”‚                          useAIAgent.ts hook                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                                       â–¼ HTTP POST /api/chat
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AI AGENT SERVICE (:8030)                                â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                     INTENT ROUTER (HÃ­brido)                          â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   1. NOW_PATTERNS (regex)                                            â”‚   â”‚
â”‚  â”‚      â””â”€> "ahora", "now", "hoy" â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> REALTIME_SCAN        â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   2. DATE_PATTERNS (regex)                                           â”‚   â”‚
â”‚  â”‚      â””â”€> "semana", "enero", "desde...hasta" â”€> HISTORICAL_ANALYSIS  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   3. SEMANTIC SIMILARITY (MiniLM-L6-v2 local)                        â”‚   â”‚
â”‚  â”‚      â””â”€> Embeddings + cosine similarity â”€â”€â”€â”€â”€> [best match intent]  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   âš ï¸ PROBLEMA: Modelo local tarda 40-60s en inicializar             â”‚   â”‚
â”‚  â”‚   âš ï¸ PROBLEMA: Regex frÃ¡gil ante variaciones de lenguaje            â”‚   â”‚
â”‚  â”‚   âš ï¸ PROBLEMA: Sin memoria de conversaciÃ³n                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      CORE V2 (MarketAgentV2)                         â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   - Gemini 2.0 Flash para generaciÃ³n                                 â”‚   â”‚
â”‚  â”‚   - Self-correction loop (3 intentos)                                â”‚   â”‚
â”‚  â”‚   - Schema injection desde schema.py                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                       â”‚                                      â”‚
â”‚                                       â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         TOOLS EXECUTOR                               â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚get_market_snapshotâ”‚  â”‚ execute_analysis â”‚  â”‚ research_ticker  â”‚  â”‚   â”‚
â”‚  â”‚   â”‚     (Redis)       â”‚  â”‚    (DuckDB)      â”‚  â”‚   (Grok/Web)     â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚   â”‚ get_ticker_info  â”‚  â”‚classify_syntheticâ”‚  â”‚get_earnings_cal  â”‚  â”‚   â”‚
â”‚  â”‚   â”‚   (Metadata)     â”‚  â”‚    (Classifier)  â”‚  â”‚    (Calendar)    â”‚  â”‚   â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Servicios Docker Relacionados

| Servicio | Puerto | FunciÃ³n |
|----------|--------|---------|
| `tradeul_ai_agent` | 8030 | Core del agente |
| `tradeul_polygon_ws` | 8006 | WebSocket Polygon (real-time) |
| `tradeul_polygon_data` | 8027 | API datos histÃ³ricos |
| `tradeul_ticker_metadata` | 8010 | Metadata de tickers |
| `tradeul_screener` | 8026 | Screener avanzado |
| `tradeul_scanner` | 8005 | Scanner en tiempo real |

### 2.3 Flujo de una Query

```
Usuario: "top gappers de la semana"
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. Intent Router (40-60s first load) â”‚
â”‚    - NOW_PATTERNS: no match          â”‚
â”‚    - DATE_PATTERNS: match "semana"   â”‚
â”‚    - Result: HISTORICAL_ANALYSIS     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. Core V2: Build System Prompt      â”‚
â”‚    - Inject schema.py (8 columnas)   â”‚
â”‚    - Call Gemini 2.0 Flash           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Gemini genera: execute_analysis() â”‚
â”‚    - Python code con SQL             â”‚
â”‚    - JOIN entre dÃ­as para gaps       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. Sandbox ejecuta en DuckDB         â”‚
â”‚    - Lee archivos Parquet            â”‚
â”‚    - Retorna DataFrame               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. Gemini genera respuesta final     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. Inventario de Datos

### 3.1 Redis (Tiempo Real)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              REDIS                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  snapshot:polygon:latest                                                     â”‚
â”‚  â”œâ”€â”€ timestamp: "2026-01-17T16:00:00Z"                                      â”‚
â”‚  â”œâ”€â”€ count: ~1000                                                            â”‚
â”‚  â””â”€â”€ tickers: [                                                              â”‚
â”‚        {                                                                     â”‚
â”‚          symbol, price, change_percent, volume,                              â”‚
â”‚          vwap, bid, ask, bid_size, ask_size,                                â”‚
â”‚          high, low, open, prev_close,                                        â”‚
â”‚          market_cap, sector, rvol                                            â”‚
â”‚        },                                                                    â”‚
â”‚        ...                                                                   â”‚
â”‚      ]                                                                       â”‚
â”‚                                                                              â”‚
â”‚  snapshot:enriched:latest (Redis Hash, 1 field por ticker)                      â”‚
â”‚                                                                              â”‚
â”‚  market:session:status ("OPEN" | "CLOSED" | "PREMARKET")                    â”‚
â”‚  market:session:current                                                      â”‚
â”‚                                                                              â”‚
â”‚  âš ï¸ Solo disponible durante horario de mercado                              â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Polygon Flat Files (DuckDB)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         POLYGON FLAT FILES                                   â”‚
â”‚                        /data/polygon/ (montado en Docker)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  day_aggs/                                                                   â”‚
â”‚  â”œâ”€â”€ Archivos: 265 (.parquet)                                               â”‚
â”‚  â”œâ”€â”€ TamaÃ±o: 146 MB                                                          â”‚
â”‚  â”œâ”€â”€ Rango: 2024-12-26 â†’ 2026-01-16 (~13 meses)                             â”‚
â”‚  â””â”€â”€ Columnas (SOLO 8):                                                      â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚      â”‚ Columna        â”‚ DescripciÃ³n                                   â”‚     â”‚
â”‚      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚      â”‚ ticker         â”‚ SÃ­mbolo (AAPL, TSLA, etc.)                    â”‚     â”‚
â”‚      â”‚ open           â”‚ Precio apertura                               â”‚     â”‚
â”‚      â”‚ high           â”‚ MÃ¡ximo del dÃ­a                                â”‚     â”‚
â”‚      â”‚ low            â”‚ MÃ­nimo del dÃ­a                                â”‚     â”‚
â”‚      â”‚ close          â”‚ Precio cierre                                 â”‚     â”‚
â”‚      â”‚ volume         â”‚ Volumen total                                 â”‚     â”‚
â”‚      â”‚ window_start   â”‚ Fecha (timestamp)                             â”‚     â”‚
â”‚      â”‚ transactions   â”‚ NÃºmero de transacciones                       â”‚     â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚      âŒ FALTAN CAMPOS CRÃTICOS:                                              â”‚
â”‚         - prev_close (para calcular gaps)                                   â”‚
â”‚         - vwap                                                               â”‚
â”‚         - atr, rsi, sma, ema                                                â”‚
â”‚         - rvol (volumen relativo)                                           â”‚
â”‚                                                                              â”‚
â”‚  minute_aggs/                                                                â”‚
â”‚  â”œâ”€â”€ Archivos: 1,765 (.csv.gz)                                              â”‚
â”‚  â”œâ”€â”€ TamaÃ±o: 32 GB                                                           â”‚
â”‚  â”œâ”€â”€ Rango: ~1 aÃ±o                                                           â”‚
â”‚  â””â”€â”€ Columnas: ticker, open, high, low, close, volume, timestamp            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 Otros Servicios de Datos

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         SERVICIOS EXTERNOS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Polygon WebSocket (polygon_ws)                                              â”‚
â”‚  â””â”€â”€ Trades, quotes en tiempo real                                          â”‚
â”‚                                                                              â”‚
â”‚  Ticker Metadata Service                                                     â”‚
â”‚  â””â”€â”€ nombre, sector, industry, market_cap, description                      â”‚
â”‚                                                                              â”‚
â”‚  Benzinga News                                                               â”‚
â”‚  â””â”€â”€ Noticias financieras en tiempo real                                    â”‚
â”‚                                                                              â”‚
â”‚  SEC Filings                                                                 â”‚
â”‚  â””â”€â”€ 10-K, 10-Q, 8-K, S-1, etc.                                             â”‚
â”‚                                                                              â”‚
â”‚  Grok Research (X.com)                                                       â”‚
â”‚  â””â”€â”€ BÃºsqueda web + sentimiento social                                      â”‚
â”‚                                                                              â”‚
â”‚  Dilution Tracker                                                            â”‚
â”‚  â””â”€â”€ AnÃ¡lisis de warrants, offerings, shelf registrations                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. AnÃ¡lisis de la SoluciÃ³n Actual

### 4.1 Problemas Identificados

| # | Problema | Impacto | Severidad |
|---|----------|---------|-----------|
| 1 | **Intent Router hÃ­brido lento** | 40-60s cold start por MiniLM local | ğŸ”´ CRÃTICO |
| 2 | **Regex frÃ¡gil** | "gappers de hoy" vs "hoy gappers" falla | ğŸ”´ CRÃTICO |
| 3 | **Sin memoria de conversaciÃ³n** | Cada query es independiente | ğŸŸ  ALTO |
| 4 | **Datos sin enriquecer** | LLM debe escribir SQL complejo | ğŸŸ  ALTO |
| 5 | **Sin RAG** | No consulta documentaciÃ³n interna | ğŸŸ¡ MEDIO |
| 6 | **Sin multi-agente** | Un solo agente para todo | ğŸŸ¡ MEDIO |

### 4.2 ComparaciÃ³n con SOTA

#### Intent Classification

| Enfoque | Tu ImplementaciÃ³n | SOTA 2025-2026 |
|---------|-------------------|----------------|
| MÃ©todo | Regex â†’ MiniLM â†’ if/else | LLM Function Calling directo |
| Latencia cold | 40-60 segundos | 0 segundos (no hay modelo local) |
| Latencia warm | ~500ms | ~200ms |
| Mantenimiento | AÃ±adir regex = cÃ³digo | AÃ±adir tool = JSON schema |
| Robustez | FrÃ¡gil | Alta (LLM entiende variaciones) |

**Referencia:** OpenAI Agents SDK, Gemini Function Calling [ver bÃºsquedas]

#### Text-to-SQL

| Enfoque | Tu ImplementaciÃ³n | SOTA 2025-2026 |
|---------|-------------------|----------------|
| Schema | 8 columnas en prompt | Schema Linking dinÃ¡mico |
| GeneraciÃ³n | Prompt bÃ¡sico | Chain-of-Thought + Self-correction |
| ValidaciÃ³n | Try/except | ETM (Enhanced Tree Matching) |
| Accuracy esperada | ~50-60% | ~73% (CHASE-SQL + Gemini) |

**Referencia:** DIN-SQL, DAIL-SQL, HLR-SQL, AutoLink [ver bÃºsquedas]

#### Memoria y Estado

| Enfoque | Tu ImplementaciÃ³n | SOTA 2025-2026 |
|---------|-------------------|----------------|
| Short-term | âŒ No implementado | Checkpointing (LangGraph) |
| Long-term | âŒ No implementado | Memory Store + Vector DB |
| Persistencia | âŒ No hay | PostgreSQL / DynamoDB |

**Referencia:** LangGraph Checkpointing, LangMem [ver bÃºsquedas]

---

## 5. Arquitecturas SOTA 2025-2026

### 5.1 Frameworks de Agentes

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    COMPARACIÃ“N DE FRAMEWORKS 2025-2026                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LangGraph                                                                   â”‚
â”‚  â”œâ”€â”€ FilosofÃ­a: State machines + grafos dirigidos                           â”‚
â”‚  â”œâ”€â”€ Best for: Enterprise SaaS, workflows complejos, alta confiabilidad     â”‚
â”‚  â”œâ”€â”€ Ventajas:                                                               â”‚
â”‚  â”‚   - Checkpointing nativo (time-travel debugging)                         â”‚
â”‚  â”‚   - Human-in-the-loop built-in                                           â”‚
â”‚  â”‚   - Ciclos y recuperaciÃ³n de errores                                     â”‚
â”‚  â””â”€â”€ Learning curve: Alta (requiere graph theory)                           â”‚
â”‚                                                                              â”‚
â”‚  CrewAI                                                                      â”‚
â”‚  â”œâ”€â”€ FilosofÃ­a: Role-based collaboration                                    â”‚
â”‚  â”œâ”€â”€ Best for: Prototipado rÃ¡pido, equipos con roles definidos              â”‚
â”‚  â”œâ”€â”€ Ventajas:                                                               â”‚
â”‚  â”‚   - Intuitivo (roles como "Researcher", "Analyst")                       â”‚
â”‚  â”‚   - RÃ¡pido de implementar                                                â”‚
â”‚  â””â”€â”€ Learning curve: Baja                                                   â”‚
â”‚                                                                              â”‚
â”‚  OpenAI Agents SDK                                                           â”‚
â”‚  â”œâ”€â”€ FilosofÃ­a: Agents, Tools, Handoffs, Guardrails                         â”‚
â”‚  â”œâ”€â”€ Best for: Ecosistema OpenAI, producciÃ³n enterprise                     â”‚
â”‚  â”œâ”€â”€ Ventajas:                                                               â”‚
â”‚  â”‚   - Sessions nativas para persistencia                                   â”‚
â”‚  â”‚   - Guardrails para validaciÃ³n                                           â”‚
â”‚  â””â”€â”€ Learning curve: Moderada                                               â”‚
â”‚                                                                              â”‚
â”‚  AutoGen (Microsoft)                                                         â”‚
â”‚  â”œâ”€â”€ FilosofÃ­a: Conversational event loops                                  â”‚
â”‚  â”œâ”€â”€ Best for: Code execution, brainstorming, Azure integration             â”‚
â”‚  â””â”€â”€ Learning curve: Moderada                                               â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 Model Context Protocol (MCP)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MODEL CONTEXT PROTOCOL (MCP)                              â”‚
â”‚              "El USB-C de la IA" - EstÃ¡ndar de Anthropic                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  MCP Host   â”‚â”€â”€â”€â”€â–¶â”‚ MCP Client  â”‚â”€â”€â”€â”€â–¶â”‚      MCP Servers            â”‚   â”‚
â”‚  â”‚ (Tu Agent)  â”‚     â”‚ (Conector)  â”‚     â”‚                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚                                           â”‚  â”‚ Polygon Data Server â”‚   â”‚   â”‚
â”‚  Primitivas:                              â”‚  â”‚ (Resources: parquet)â”‚   â”‚   â”‚
â”‚                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  Resources: Datos read-only               â”‚                             â”‚   â”‚
â”‚  Tools: Funciones ejecutables             â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  Prompts: Templates predefinidos          â”‚  â”‚  Redis Server       â”‚   â”‚   â”‚
â”‚                                           â”‚  â”‚  (Resources: snap)  â”‚   â”‚   â”‚
â”‚                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  Beneficios:                              â”‚                             â”‚   â”‚
â”‚  - Un conector sirve para TODOS los LLMs  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  - Estandarizado (OpenAI, Google, etc.)   â”‚  â”‚  SEC Filings Server â”‚   â”‚   â”‚
â”‚  - SeparaciÃ³n de concerns                 â”‚  â”‚  (Tools: search)    â”‚   â”‚   â”‚
â”‚                                           â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚                                           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.3 Arquitectura Multi-Agente para Finanzas

Basado en papers: FinRobot, AlphaAgents, Orchestration Framework for Financial Agents

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MULTI-AGENT FINANCIAL SYSTEM                              â”‚
â”‚                    (Council of Experts Pattern)                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                        â”‚   ORCHESTRATOR     â”‚                                â”‚
â”‚                        â”‚   (Supervisor)     â”‚                                â”‚
â”‚                        â”‚                    â”‚                                â”‚
â”‚                        â”‚ - Recibe query     â”‚                                â”‚
â”‚                        â”‚ - Delega a expertosâ”‚                                â”‚
â”‚                        â”‚ - Sintetiza resp.  â”‚                                â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                  â”‚                                           â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚          â”‚                       â”‚                       â”‚                  â”‚
â”‚          â–¼                       â–¼                       â–¼                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  TECHNICAL    â”‚      â”‚ FUNDAMENTAL   â”‚      â”‚  SENTIMENT    â”‚           â”‚
â”‚  â”‚    AGENT      â”‚      â”‚    AGENT      â”‚      â”‚    AGENT      â”‚           â”‚
â”‚  â”‚               â”‚      â”‚               â”‚      â”‚               â”‚           â”‚
â”‚  â”‚ - RSI, MACD   â”‚      â”‚ - P/E, EPS    â”‚      â”‚ - News        â”‚           â”‚
â”‚  â”‚ - SMA, EMA    â”‚      â”‚ - Balance     â”‚      â”‚ - Social      â”‚           â”‚
â”‚  â”‚ - Gaps, ATR   â”‚      â”‚ - Cash flow   â”‚      â”‚ - Sentiment   â”‚           â”‚
â”‚  â”‚               â”‚      â”‚               â”‚      â”‚               â”‚           â”‚
â”‚  â”‚ Data: DuckDB  â”‚      â”‚ Data: SEC API â”‚      â”‚ Data: Grok    â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚          â”‚                       â”‚                       â”‚                  â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚                                  â”‚                                           â”‚
â”‚                                  â–¼                                           â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                â”‚
â”‚                        â”‚   SYNTHESIS        â”‚                                â”‚
â”‚                        â”‚   AGENT            â”‚                                â”‚
â”‚                        â”‚                    â”‚                                â”‚
â”‚                        â”‚ Combina insights   â”‚                                â”‚
â”‚                        â”‚ de todos los       â”‚                                â”‚
â”‚                        â”‚ expertos           â”‚                                â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.4 RAG Avanzado (2025-2026)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ADVANCED RAG PIPELINE                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  INDEXING (Offline)                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                           â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Documents  â”‚â”€â”€â”€â–¶â”‚ Semantic Chunk  â”‚â”€â”€â”€â–¶â”‚ Metadata Enrich â”‚             â”‚
â”‚  â”‚  (SEC, etc) â”‚    â”‚ (not fixed-size)â”‚    â”‚ (GLiNER tags)   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                      â”‚                       â”‚
â”‚                                                      â–¼                       â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                            â”‚  Vector Store   â”‚              â”‚
â”‚                                            â”‚  (pgvector)     â”‚              â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  RETRIEVAL (Online)                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Query     â”‚â”€â”€â”€â–¶â”‚ Query Rewriting â”‚â”€â”€â”€â–¶â”‚  Hybrid Search  â”‚             â”‚
â”‚  â”‚             â”‚    â”‚ (expand/clarify)â”‚    â”‚ (BM25 + Vector) â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                      â”‚                       â”‚
â”‚                                                      â–¼                       â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                            â”‚ Cross-Encoder   â”‚              â”‚
â”‚                                            â”‚ Reranking       â”‚              â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                      â”‚                       â”‚
â”‚                                                      â–¼                       â”‚
â”‚                                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚                                            â”‚ Context to LLM  â”‚              â”‚
â”‚                                            â”‚ (top-k chunks)  â”‚              â”‚
â”‚                                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚                                                                              â”‚
â”‚  TÃ©cnicas avanzadas:                                                         â”‚
â”‚  - GraphRAG: Knowledge graphs para relaciones complejas                     â”‚
â”‚  - Agentic RAG: El agente decide estrategia de retrieval                    â”‚
â”‚  - RankRAG: Un solo LLM hace ranking + generaciÃ³n                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. RecomendaciÃ³n de Arquitectura

### 6.1 Arquitectura Propuesta

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ARQUITECTURA PROPUESTA TRADEUL                           â”‚
â”‚                          (SOTA 2025-2026)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                              â”‚   FRONTEND     â”‚                              â”‚
â”‚                              â”‚   (Next.js)    â”‚                              â”‚
â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                      â”‚                                       â”‚
â”‚                                      â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                        LANGGRAPH ORCHESTRATOR                          â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚  â”‚
â”‚  â”‚   â”‚                    STATE (TypedDict)                         â”‚     â”‚  â”‚
â”‚  â”‚   â”‚   - messages: List[Message]                                  â”‚     â”‚  â”‚
â”‚  â”‚   â”‚   - current_ticker: Optional[str]                            â”‚     â”‚  â”‚
â”‚  â”‚   â”‚   - analysis_results: Dict                                   â”‚     â”‚  â”‚
â”‚  â”‚   â”‚   - user_preferences: Dict                                   â”‚     â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚  â”‚
â”‚  â”‚   â”‚  ROUTER   â”‚â”€â”€â”€â”€â–¶â”‚ ANALYST   â”‚â”€â”€â”€â”€â–¶â”‚ SYNTHESIS â”‚                   â”‚  â”‚
â”‚  â”‚   â”‚   NODE    â”‚     â”‚   NODE    â”‚     â”‚   NODE    â”‚                   â”‚  â”‚
â”‚  â”‚   â”‚           â”‚     â”‚           â”‚     â”‚           â”‚                   â”‚  â”‚
â”‚  â”‚   â”‚ Gemini FC â”‚     â”‚ Specialistâ”‚     â”‚ Final     â”‚                   â”‚  â”‚
â”‚  â”‚   â”‚ decides   â”‚     â”‚ execution â”‚     â”‚ response  â”‚                   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚  â”‚
â”‚  â”‚         â”‚                 â”‚                                            â”‚  â”‚
â”‚  â”‚         â”‚           â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”                                     â”‚  â”‚
â”‚  â”‚         â”‚           â”‚           â”‚                                     â”‚  â”‚
â”‚  â”‚         â–¼           â–¼           â–¼                                     â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚   â”‚                    TOOL REGISTRY                              â”‚   â”‚  â”‚
â”‚  â”‚   â”‚                                                                â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  @function_tool                                                â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  def get_market_data(                                          â”‚   â”‚  â”‚
â”‚  â”‚   â”‚      timeframe: Literal["realtime", "historical"],            â”‚   â”‚  â”‚
â”‚  â”‚   â”‚      query: str,                                               â”‚   â”‚  â”‚
â”‚  â”‚   â”‚      tickers: Optional[List[str]] = None                       â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  ) -> MarketDataResult:                                        â”‚   â”‚  â”‚
â”‚  â”‚   â”‚      if timeframe == "realtime":                               â”‚   â”‚  â”‚
â”‚  â”‚   â”‚          return redis_snapshot()                               â”‚   â”‚  â”‚
â”‚  â”‚   â”‚      else:                                                     â”‚   â”‚  â”‚
â”‚  â”‚   â”‚          return duckdb_query()                                 â”‚   â”‚  â”‚
â”‚  â”‚   â”‚                                                                â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  @function_tool                                                â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  def research(ticker: str, depth: str) -> ResearchResult       â”‚   â”‚  â”‚
â”‚  â”‚   â”‚                                                                â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  @function_tool                                                â”‚   â”‚  â”‚
â”‚  â”‚   â”‚  def analyze_filings(ticker: str) -> FilingsResult             â”‚   â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                                         â”‚  â”‚
â”‚  â”‚   PERSISTENCE:                                                          â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚   â”‚  PostgresSaver (Checkpointing)                                  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â””â”€â”€ thread_id â†’ conversaciÃ³n completa                          â”‚  â”‚  â”‚
â”‚  â”‚   â”‚                                                                  â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  Memory Store (Long-term)                                        â”‚  â”‚  â”‚
â”‚  â”‚   â”‚  â””â”€â”€ user_id â†’ preferencias, tickers seguidos, etc.             â”‚  â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                      â”‚                                       â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚                    â–¼                 â–¼                 â–¼                    â”‚
â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚            â”‚    REDIS    â”‚   â”‚   DUCKDB    â”‚   â”‚   GROK/     â”‚             â”‚
â”‚            â”‚  (realtime) â”‚   â”‚ (historical)â”‚   â”‚    WEB      â”‚             â”‚
â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 6.2 Cambios Clave

| Componente | Actual | Propuesto |
|------------|--------|-----------|
| **Router** | Regex + MiniLM local | Gemini Function Calling (el LLM decide) |
| **OrquestaciÃ³n** | if/else hardcodeado | LangGraph con nodos y edges |
| **Estado** | Sin estado | TypedDict con checkpointing |
| **Memoria** | No hay | PostgresSaver + Memory Store |
| **Tools** | 8 funciones separadas | Tools unificadas con Pydantic schemas |
| **Datos** | 8 columnas | 35 columnas enriquecidas |

### 6.3 Datos Enriquecidos

```python
# day_aggs_enriched/ - Nueva estructura (35 campos)

# Originales (8)
ticker, open, high, low, close, volume, window_start, transactions

# Precio derivados (8)
prev_close,         # Cierre dÃ­a anterior
gap_pct,            # (open - prev_close) / prev_close * 100
change_pct,         # (close - open) / open * 100  
daily_return,       # (close - prev_close) / prev_close * 100
range_pct,          # (high - low) / low * 100
body_pct,           # abs(close - open) / (high - low) * 100
upper_wick,         # (high - max(open, close)) / (high - low)
lower_wick          # (min(open, close) - low) / (high - low)

# Volatilidad (5)
atr_5, atr_14,      # Average True Range
std_20,             # DesviaciÃ³n estÃ¡ndar 20 dÃ­as
bb_upper, bb_lower  # Bollinger Bands (20, 2)

# Tendencia (7)
sma_5, sma_10, sma_20, sma_50, sma_200,  # Simple Moving Averages
ema_9, ema_21                             # Exponential Moving Averages

# Volumen (4)
avg_vol_10, avg_vol_20,  # Volumen promedio
rvol,                     # Relative Volume (today / avg)
dollar_volume             # close * volume

# Momentum (3)
rsi_14,                   # Relative Strength Index
roc_5, roc_10             # Rate of Change
```

---

## 7. Plan de ImplementaciÃ³n

### 7.1 Fases

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PLAN DE IMPLEMENTACIÃ“N                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  FASE 1: Data Enrichment                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚  - Crear script de enriquecimiento de day_aggs                              â”‚
â”‚  - Generar 265 archivos parquet con 35 columnas                             â”‚
â”‚  - Actualizar schema.py con nuevos campos                                   â”‚
â”‚  - Esfuerzo: ~2 dÃ­as                                                         â”‚
â”‚                                                                              â”‚
â”‚  FASE 2: Eliminar Intent Router                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚  - Usar Gemini Function Calling nativo                                       â”‚
â”‚  - Definir tools con Pydantic schemas                                        â”‚
â”‚  - El LLM decide quÃ© tool usar (sin regex, sin embeddings)                  â”‚
â”‚  - Esfuerzo: ~2 dÃ­as                                                         â”‚
â”‚                                                                              â”‚
â”‚  FASE 3: LangGraph Integration                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚  - Definir StateGraph con nodos                                              â”‚
â”‚  - Implementar PostgresSaver para checkpointing                              â”‚
â”‚  - AÃ±adir Memory Store para preferencias                                     â”‚
â”‚  - Esfuerzo: ~3 dÃ­as                                                         â”‚
â”‚                                                                              â”‚
â”‚  FASE 4: RAG (Opcional)                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  - Indexar SEC filings con semantic chunking                                â”‚
â”‚  - Implementar hybrid search (BM25 + vector)                                â”‚
â”‚  - AÃ±adir reranking                                                          â”‚
â”‚  - Esfuerzo: ~5 dÃ­as                                                         â”‚
â”‚                                                                              â”‚
â”‚  FASE 5: Multi-Agent (Opcional)                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚  - Especializar agentes (Technical, Fundamental, Sentiment)                 â”‚
â”‚  - Implementar Orchestrator                                                  â”‚
â”‚  - AÃ±adir critique loops                                                     â”‚
â”‚  - Esfuerzo: ~5 dÃ­as                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 PriorizaciÃ³n Recomendada

| Prioridad | Fase | Impacto | Esfuerzo |
|-----------|------|---------|----------|
| ğŸ”´ P0 | 1. Data Enrichment | Alto | 2 dÃ­as |
| ğŸ”´ P0 | 2. Eliminar Intent Router | Alto | 2 dÃ­as |
| ğŸŸ  P1 | 3. LangGraph + Memoria | Alto | 3 dÃ­as |
| ğŸŸ¡ P2 | 4. RAG | Medio | 5 dÃ­as |
| ğŸŸ¢ P3 | 5. Multi-Agent | Medio | 5 dÃ­as |

### 7.3 Stack TecnolÃ³gico Recomendado

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         STACK RECOMENDADO                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  LLM:           Gemini 2.0 Flash (actual) âœ…                                â”‚
â”‚  OrquestaciÃ³n:  LangGraph (nuevo)                                           â”‚
â”‚  Checkpointing: PostgresSaver (nuevo)                                        â”‚
â”‚  Memory Store:  pgvector en PostgreSQL (nuevo)                              â”‚
â”‚  Function Call: Gemini nativo (reemplaza Intent Router)                     â”‚
â”‚  Text-to-SQL:   Schema Linking + Self-correction (mejorar actual)           â”‚
â”‚  RAG:           Semantic chunking + BM25 + Reranking (nuevo, opcional)      â”‚
â”‚                                                                              â”‚
â”‚  NO RECOMENDADO:                                                             â”‚
â”‚  - CrewAI (overkill para un solo agente)                                    â”‚
â”‚  - AutoGen (mejor para code execution, no para finanzas)                    â”‚
â”‚  - Modelo de embeddings local (aÃ±ade latencia innecesaria)                  â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 8. Conclusiones

### Â¿Es correcta la soluciÃ³n actual?

**NO.** La arquitectura actual tiene problemas fundamentales:

1. **Intent Router hÃ­brido** es un anti-patrÃ³n en 2025-2026. Los LLMs modernos con Function Calling nativo hacen esto mejor.

2. **Embeddings locales** aÃ±aden latencia sin beneficio real. Gemini puede decidir quÃ© tool usar directamente.

3. **Sin memoria** significa que cada conversaciÃ³n empieza de cero. LangGraph con checkpointing es el estÃ¡ndar.

### RecomendaciÃ³n Final

Implementar **Fases 1-3** (Data Enrichment + Eliminar Router + LangGraph) para tener una arquitectura alineada con SOTA 2025-2026.

**Resultado esperado:**
- Latencia: De 40-60s cold start a ~200ms constante
- Accuracy: De ~50% a ~70% en queries complejas
- UX: Conversaciones con memoria y contexto
- Mantenimiento: AÃ±adir tools = aÃ±adir JSON schema

---

*Documento generado: 2026-01-20*  
*Basado en investigaciÃ³n de: LangGraph, CrewAI, AutoGen, OpenAI Agents SDK, MCP, DIN-SQL, DAIL-SQL, HLR-SQL, FinRobot, AlphaAgents*
